var con = 0, tb; function recargarDatos(t) { tb.fnClearTable(), tb.fnAddData(t) } function cargarDatos(t) { tb = $("#grvLista").dataTable({ data: t, columnDefs: [{ width: "15%", targets: [0] }, { width: "25%", targets: [1] }, { width: "20%", targets: [2] }, { width: "40%", targets: [3] }], columns: [{ title: "Tipo", data: "Tipo" }, { title: "Cantidad", data: "cantidad" }, { title: "Total", data: "total" }, { title: "", data: null, render: function (t, n, o) { return '<div class="row justify-content-center"><button type="button" onclick="eliminar(' + t.producto + ')" class="btn btn-danger">Eliminar</button></div>' } }], fnInitComplete: function (t, n) { var o = $(this).children("thead").children("tr").clone(), e = $("<tfoot/>").append(o).css("display", "table-header-group"); $(this).children("thead").after(e), $(o).children().each(function () { $(this).prop("class", null) }), $(o).children("th").each(function () { var t = $(this).text(); $(this).html('<input type="text" class="filtro form-control input-sm" style = "width:90%;" placeholder = "Buscar ' + t + '" /> ') }), $(o).children("th:last").html(""); var a = this; a.api().columns().eq(0).each(function (t) { $("#grvLista tfoot th:eq(" + t + ") input").on("keyup change", function () { a.api().column(t).search(this.value).draw() }), $("input", a.api().column(t).footer()).on("click", function (t) { t.stopPropagation() }) }) } }) } function eliminar(t) { t.preventDefault, $.ajax({ url: "WS/WSVenta.asmx/quitarDetalle", data: '{ "id":"' + t + '"}', contentType: "application/json; utf-8", dataType: "json", type: "POST", success: function (t) { recargarDatos(JSON.parse(t.d)), con -= 1, console.log(t) }, error: function (t) { console.log(t) } }) } $(document).ready(function nombres(e) { $("#frm").validate({ rules: { ctl00$ctl00$contenido$contenido$txtCantidad: { required: !0 } }, messages: { ctl00$ctl00$contenido$contenido$txtCantidad: { required: "Por favor, ingrese una Cantidad" } } }), e.preventDefault, $.ajax({ url: "WS/WSArticulos.asmx/GetNombres", data: {}, contentType: "application/json; utf-8", dataType: "json", type: "POST", success: function (data) { var models = "string" == typeof data.d ? eval("(" + data.d + ") ") : data.d; $("#contenido_contenido_CboxProducto").get(0).options.length = 0; for (var i = 0; i < models.length; i++) { var val = models[i]; $("#contenido_contenido_CboxProducto").get(0).options[$("#contenido_contenido_CboxProducto").get(0).options.length] = new Option(val) } console.log(data) }, error: function (t) { console.log(t) } }) }), $(document).ready(function () { $("#frm").validate({ rules: { ctl00$ctl00$contenido$contenido$txtCantidad: { required: !0 } }, messages: { ctl00$ctl00$contenido$contenido$txtCantidad: { required: "Por favor, ingrese una Cantidad" } } }), $("#contenido_contenido_btnAgregar").click(function (t) { t.preventDefault(); var n = $("#contenido_contenido_CboxProducto").val(), o = $("#contenido_contenido_txtCantidad").val(); o > 0 ? $.ajax({ url: "WS/WSVenta.asmx/detalle", data: '{ "producto":"' + n + '", "Cantidad": "' + o + '"}', contentType: "application/json; utf-8", dataType: "json", type: "POST", success: function (t) { null != t ? (console.log(JSON.parse(t.d)), con < 1 ? (cargarDatos(JSON.parse(t.d)), con += 1) : recargarDatos(JSON.parse(t.d))) : ($("#mensaje").html('<button type="button" class="close" data-dismiss="alert" >&times;</button><strong > revise los datos </strong >'), $("#mensaje").show()) }, error: function (t) { $("#mensaje").html('<button type="button" class="close" data-dismiss="alert" >&times;</button><strong > revise los datos </strong >'), $("#mensaje").show(), console.log(t) } }) : ($("#mensaje").html('<button type="button" class="close" data-dismiss="alert" >&times;</button><strong > la cantidad debe ser mayor a 0 </strong >'), $("#mensaje").show()) }) }), $(document).ready(function () { $("#frm").validate({ rules: { ctl00$ctl00$contenido$contenido$txtCantidad: { required: !0 } }, messages: { ctl00$ctl00$contenido$contenido$txtCantidad: { required: "Por favor, ingrese una Cantidad" } } }), $("#contenido_contenido_btnAceptar").click(function (t) { t.preventDefault(); var n = $("#contenido_contenido_txtDescripcion").val(), o = $("#contenido_contenido_lbltotal").html(); $.ajax({ url: "WS/WSVenta.asmx/Agregar", data: '{"Total":"' + o + '", "Descripcion": "' + n + '"}', contentType: "application/json; utf-8", dataType: "json", type: "POST", success: function (t) { sessionStorage.setItem("indx", null), sessionStorage.setItem("accion", "Venta"), location.href = "index.html", console.log(t) }, error: function (t) { $("#mensaje").html('<button type="button" class="close" data-dismiss="alert" >&times;</button><strong > a acurrido un error </strong >'), $("#mensaje").show(), console.log(t) } }) }) });